{% extends "layout.html" %}
{% block content %}
<h2>Diary Grid</h2>
<div class="diary-grid">
    {% for diary in diaries %}
        <a href="{{ url_for('edit_diary', id=diary.id) }}" class="diary-tile" style="background-color: {{ diary.color }}"></a>
    {% endfor %}
</div>
<style>
    .diary-grid {
        display: grid;
        gap: 5px;
        padding: 10px;
        height: calc(100vh - 150px); /* Adjust for navbar and heading */
        box-sizing: border-box;
    }
    .diary-tile {
        border-radius: 5px;
        cursor: pointer;
    }
    @media (max-width: 576px) {
        .diary-grid {
            gap: 3px;
            padding: 5px;
            height: calc(100vh - 120px); /* Adjust for smaller screens */
        }
    }
</style>
<script>
    function adjustGrid() {
        const grid = document.querySelector('.diary-grid');
        const tiles = document.querySelectorAll('.diary-tile');
        const count = tiles.length;
        if (count === 0) return;

        // Get viewport dimensions
        const vw = window.innerWidth;
        const vh = grid.clientHeight; // Use grid height (accounts for navbar/heading)

        // Calculate number of rows/columns to fit all tiles
        const sqrt = Math.ceil(Math.sqrt(count));
        const cols = sqrt;
        let rows = Math.ceil(count / cols);

        // Calculate tile size to fit viewport
        const tileWidth = (vw - (cols - 1) * 5 - 20) / cols; // Account for gap and padding
        const tileHeight = (vh - (rows - 1) * 5 - 20) / rows; // Account for gap and padding
        const tileSize = Math.min(tileWidth, tileHeight); // Ensure square tiles

        // Adjust rows if needed to fit all tiles
        if (tileSize * rows < vh && count > cols) {
            rows = Math.floor(vh / tileSize);
            if (rows * cols < count) rows++;
        }

        // Update grid
        grid.style.gridTemplateColumns = `repeat(${cols}, ${tileSize}px)`;
        grid.style.gridTemplateRows = `repeat(${rows}, ${tileSize}px)`;
        tiles.forEach(tile => {
            tile.style.width = `${tileSize}px`;
            tile.style.height = `${tileSize}px`;
        });

        // Center grid if fewer tiles than grid cells
        grid.style.display = 'grid';
        grid.style.justifyContent = 'center';
        grid.style.alignContent = 'center';
    }

    window.addEventListener('load', adjustGrid);
    window.addEventListener('resize', adjustGrid);
</script>
{% endblock %}